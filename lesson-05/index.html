<!DOCTYPE html>
<html lang="en">
<head>
  <link rel="stylesheet" href="../assets/brand.css">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Place Value Game: Tens and Ones</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.49/Tone.min.js"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            /* === THAY ƒê·ªîI: Quay l·∫°i n·ªÅn v√†ng/cam === */
            background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%); 
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            overflow: hidden; 
        }

        #game-container {
            width: 100%;
            max-width: 950px; 
            height: 95vh; 
            display: flex;
            flex-direction: column;
            padding: 1.5rem; 
            background-color: #ffffff;
            border-radius: 2.5rem; 
            /* THAY ƒê·ªîI: Gi·∫£m ƒë·ªô ph·ª©c t·∫°p c·ªßa b√≥ng ƒë·ªï */
            box-shadow: 0 15px 30px -10px rgba(0, 0, 0, 0.15); 
        }
        
        #game-container h1 {
            color: #E91E63; 
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1); 
        }

        .grid-area {
            flex: 1 1 auto;
            min-height: 0; 
            display: flex;
            flex-direction: column; 
            /* THAY ƒê·ªîI: Gi·∫£m kho·∫£ng c√°ch */
            gap: 1rem; 
            margin-bottom: 1rem;
        }

        @media (min-width: 768px) { 
            .grid-area {
                flex-direction: row; 
            }
        }
        
        .item-column, .drop-chart-container {
            background-color: #fcfcfc; 
            border-radius: 1.5rem; 
            padding: 1rem; 
            /* === THAY ƒê·ªîI: G·ª° b·ªè b√≥ng ƒë·ªï b√™n trong === */
            /* box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.06); */ 
        }

        .drop-column, .item-column {
            flex: 1; 
            min-height: 150px; 
            /* THAY ƒê·ªîI: ·∫®n thanh cu·ªôn */
            overflow-y: hidden; 
        }
        @media (min-width: 768px) {
            .drop-column, .item-column {
                min-height: 250px; 
            }
        }
        
        .item-column h2, .drop-chart-container h2 {
            color: #673AB7; /* T√≠m */
            font-size: 1.25rem; /* text-xl */
            text-shadow: 1px 1px 2px rgba(0,0,0,0.05);
        }

        .draggable {
            cursor: grab;
            user-select: none;
            transition: transform 0.2s ease, box-shadow 0.2s ease, opacity 0.2s ease;
        }
        .draggable:active {
            cursor: grabbing;
            transform: scale(1.15) rotate(5deg); 
            /* THAY ƒê·ªîI: Gi·∫£m ƒë·ªô ph·ª©c t·∫°p c·ªßa b√≥ng ƒë·ªï */
            box-shadow: 0 10px 15px -5px rgba(0, 0, 0, 0.15); 
            z-index: 50;
            opacity: 0.8;
        }

        .drop-column {
            border: 4px dashed #FF6F00; /* Vi·ªÅn n√©t ƒë·ª©t cam */
            transition: background-color 0.2s ease, border-color 0.2s ease, border-style 0.2s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .drop-area {
            display: flex;
            flex-direction: row;
            flex-wrap: wrap;
            justify-content: center;
            align-items: start;
            width: 100%;
            height: 100%; 
            min-height: 50px; 
            padding: 8px; 
        }

        #tens-column {
            background-color: #fefce8; /* === THAY ƒê·ªîI: Quay l·∫°i m√†u v√†ng nh·∫°t === */
        }
        #ones-column {
            background-color: #f0fdf4; /* === THAY ƒê·ªîI: Quay l·∫°i m√†u xanh nh·∫°t === */
        }

        .drag-over {
            background-color: #FFF3E0; 
            border-color: #FF6F00;
            border-style: solid; 
        }
        
        #item-container {
            min-height: 100px; 
            flex-wrap: wrap; 
            justify-content: center;
            align-items: center;
            gap: 0.5rem; 
        }

        /* === THAY ƒê·ªîI: Thu nh·ªè kh·ªëi Tens === */
        .tens-bundle {
            background-color: #fef9c3; 
            border: 3px solid #f59e0b; 
            border-radius: 0.75rem; 
            display: flex;
            flex-wrap: wrap;
            width: 5.0rem; /* Nh·ªè h∆°n */
            height: 5.0rem; /* Nh·ªè h∆°n */
            font-size: 0.8rem; /* Nh·ªè h∆°n */
            justify-content: center;
            align-items: center;
            padding: 0.35rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }
        @media (min-width: 640px) { 
            .tens-bundle {
                width: 5.5rem; /* Nh·ªè h∆°n */
                height: 5.5rem; /* Nh·ªè h∆°n */
                font-size: 1.0rem; /* Nh·ªè h∆°n */
            }
        }

        /* === THAY ƒê·ªîI: Thu nh·ªè kh·ªëi Ones === */
        .ones-item {
            background-color: #ecfdf5; 
            border: 3px solid #16a34a; 
            border-radius: 0.5rem; 
            font-size: 1.0rem; /* Nh·ªè h∆°n */
            width: 2.0rem; /* Nh·ªè h∆°n */
            height: 2.0rem; /* Nh·ªè h∆°n */
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 0.125rem; /* Nh·ªè h∆°n */
            box-shadow: 0 2px 4px -1px rgba(0, 0, 0, 0.1);
        }
        @media (min-width: 640px) { 
            .ones-item {
                font-size: 1.2rem; /* Nh·ªè h∆°n */
                width: 2.2rem; /* Nh·ªè h∆°n */
                height: 2.2rem; /* Nh·ªè h∆°n */
            }
        }
        
        /* === THAY ƒê·ªîI: Thu nh·ªè n√∫t ƒë√°p √°n === */
        .answer-btn {
            transition: transform 0.1s ease, background-color 0.2s ease, box-shadow 0.2s ease;
            padding: 0.5rem 1.2rem; /* Nh·ªè h∆°n */
            font-size: 1.125rem; /* Nh·ªè h∆°n */
            font-weight: 700; 
            border-radius: 1rem; 
            color: white;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.15); 
            
            /* === B·∫ÆT ƒê·∫¶U S·ª¨A L·ªñI === */
            position: relative; /* ƒê·∫£m b·∫£o z-index ho·∫°t ƒë·ªông */
            z-index: 10;        /* ƒê∆∞a n√∫t l√™n tr√™n */
            /* === K·∫æT TH√öC S·ª¨A L·ªñI === */
        }
        .answer-btn:nth-child(1) { background-color: #2196F3; } /* Blue */
        .answer-btn:nth-child(2) { background-color: #E91E63; } /* Pink */
        .answer-btn:nth-child(3) { background-color: #9C27B0; } /* Purple */

        .answer-btn:hover:not(:disabled) {
            transform: translateY(-4px) scale(1.05); 
            /* THAY ƒê·ªîI: Gi·∫£m ƒë·ªô ph·ª©c t·∫°p c·ªßa b√≥ng ƒë·ªï */
            box-shadow: 0 10px 15px -5px rgba(0, 0, 0, 0.15);
        }
        .answer-btn:disabled {
            opacity: 0.6; 
            cursor: not-allowed;
            transform: none; 
            box-shadow: none;
        }
        .btn-correct {
            background-color: #4CAF50 !important; /* Green */
            transform: scale(1.08) !important; 
            box-shadow: 0 8px 15px -3px rgba(76, 175, 80, 0.5) !important;
        }
        .btn-wrong {
             background-color: #F44336 !important; /* Red */
        }

        #feedback {
            font-size: 1.5rem; 
            font-weight: 800; 
            min-height: 2.5rem; 
            text-shadow: 1px 1px 3px rgba(0,0,0,0.2); 
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(15px); } 
            to { opacity: 1; transform: translateY(0); }
        }

        .mystery-box-item {
            /* THAY ƒê·ªîI: Hi·ªáu ·ª©ng pulse ƒë∆°n gi·∫£n h∆°n */
            animation: pulseSimple 1.5s infinite ease-in-out; 
            font-size: 6rem; 
            /* TH√äM: C·∫ßn thi·∫øt cho ƒëi·ªÉm b·∫≠t l√™n */
            position: relative;
        }
        /* THAY ƒê·ªîI: Hi·ªáu ·ª©ng pulse ƒë∆°n gi·∫£n h∆°n */
        @keyframes pulseSimple {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        /* X√ìA @keyframes pulse c≈©
        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 1;}
            50% { transform: scale(1.15); opacity: 0.8;} 
        }
        */
        
        #start-overlay {
            background-color: rgba(255, 255, 255, 0.98); 
        }
        #start-btn {
            background-color: #FF6F00; 
            border: 3px solid #FFD700;
            box-shadow: 0 8px 15px -3px rgba(255, 111, 0, 0.4);
        }
        #start-btn:hover {
            background-color: #F57C00; 
            transform: scale(1.1);
        }
        
        #mystery-box-content {
            padding: 2rem; 
            border-radius: 1.5rem;
            box-shadow: 0 15px 30px -5px rgba(0, 0, 0, 0.2);
            border: 3px solid #9C27B0; 
        }
        #mystery-box-content h2 {
            font-size: 2rem; 
            color: #9C27B0; 
        }
        #mystery-box-content .mystery-box-item {
            font-size: 5rem; 
        }
        @media (min-width: 640px) { 
            #mystery-box-content h2 {
                font-size: 2.5rem; 
            }
            #mystery-box-content .mystery-box-item {
                font-size: 6rem; 
            }
        }

        #completion-message {
            color: #4CAF50;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
            font-size: 2.5rem;
        }
        #completion-message span {
            color: #FF6F00; 
        }

        /* === TH√äM: CSS CHO ƒêI·ªÇM B·∫¨T L√äN === */
        .points-display {
            font-size: 2.5rem; /* text-4xl */
            font-weight: 900; /* font-black */
            color: #f59e0b; /* text-amber-500 */
            text-shadow: 1px 1px 0px #b45309, 2px 2px 0px #b45309; /* Hi·ªáu ·ª©ng 3D */
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0.5);
            opacity: 0;
            animation: popUpPoints 0.5s ease-out forwards;
            pointer-events: none; /* Kh√¥ng cho nh·∫•p v√†o */
        }
        @keyframes popUpPoints {
            0% { transform: translate(-50%, -50%) scale(0.5); opacity: 0; }
            60% { transform: translate(-50%, -65%) scale(1.2); opacity: 1; }
            100% { transform: translate(-50%, -70%) scale(1); opacity: 1; }
        }
        /* Th√™m class ƒë·ªÉ l√†m m·ªù emoji */
        .prize-emoji {
            transition: opacity 0.3s ease-out;
        }
        /* === K·∫æT TH√öC TH√äM CSS === */

    </style>
</head>
<body class="text-gray-800">
   <img src="../assets/logo-oodles-math.png" class="oodles-logo"> 
    <div id="start-overlay">
        <button id="start-btn" class="bg-green-500 hover:bg-green-600 text-white font-bold py-4 px-10 rounded-full text-3xl shadow-lg transition duration-200 transform hover:scale-105">
            Start Game
        </button>
    </div>

    <div id="game-container" class="w-full max-w-4xl mx-auto p-4 sm:p-6 md:p-8 rounded-2xl shadow-xl hidden">
        
        <!-- THAY ƒê·ªîI: Gi·∫£m l·ªÅ -->
        <h1 class="text-3xl sm:text-4xl font-bold text-center text-blue-600 mb-1">
            Place Value: Tens & Ones
        </h1>
        
        <!-- THAY ƒê·ªîI: Gi·∫£m l·ªÅ -->
        <div class="text-xl font-bold text-center text-purple-600 mb-2">
            Score: <span id="score-display">0</span>
        </div>
        
        <!-- THAY ƒê·ªîI: Gi·∫£m l·ªÅ -->
        <p id="instruction" class="text-lg sm:text-xl text-center text-gray-700 mb-2 min-h-[3rem]">
            Drag the blocks to the correct column!
        </p>

        <div class="grid-area">
            
            <div class="item-column p-2 sm:p-4 shadow-inner">
                <!-- THAY ƒê·ªîI: Gi·∫£m l·ªÅ -->
                <h2 class="text-lg font-semibold text-center mb-1 text-indigo-600">Blocks to Drag</h2>
                <!-- THAY ƒê·ªîI: Gi·∫£m kho·∫£ng c√°ch -->
                <div id="item-container" class="flex flex-wrap justify-center items-center gap-1 sm:gap-2">
                </div>
                
                <!-- THAY ƒê·ªîI: Gi·∫£m l·ªÅ -->
                <div class="mt-2">
                    <!-- THAY ƒê·ªîI: Gi·∫£m l·ªÅ -->
                    <h3 class="text-lg font-semibold text-center mb-1 text-indigo-600">So... how many are there in all?</h3>
                    <!-- THAY ƒê·ªîI: Gi·∫£m kho·∫£ng c√°ch -->
                    <div id="options-container" class="flex justify-center flex-wrap gap-1 sm:gap-2">
                    </div>
                </div>

            </div>

            <div class="drop-chart-container flex-1 p-2 sm:p-4 shadow-inner">
                <!-- THAY ƒê·ªîI: Gi·∫£m l·ªÅ -->
                <h2 class="text-lg font-semibold text-center mb-1 text-indigo-600">Place Value Chart</h2>
                <div class="grid grid-cols-2 gap-2 sm:gap-4 h-full">
                    <div id="tens-column" data-column="tens" class="drop-column p-1 sm:p-2 rounded-lg">
                        <h3 class="text-xl font-bold text-yellow-500 mb-1">Tens</h3>
                        <div id="tens-drop-area" class="drop-area">
                        </div>
                    </div>
                    <div id="ones-column" data-column="ones" class="drop-column p-1 sm:p-2 rounded-lg">
                        <h3 class="text-xl font-bold text-green-500 mb-1">Ones</h3>
                        <div id="ones-drop-area" class="drop-area">
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- THAY ƒê·ªîI: Gi·∫£m l·ªÅ -->
        <div class="mt-2 text-center">
            <div id="feedback" class="mb-2"></div>
            <button id="next-btn" class="hidden bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-6 rounded-full text-lg shadow-lg transition duration-200">
                Next Question
            </button>
            <div id="completion-message" class="hidden text-2xl font-bold text-green-600 p-4 text-center fade-in">
                üéâ Congratulations! You finished the game! Great job! üéâ
            </div>
        </div>
    </div>

    <div id="mystery-box-overlay" class="hidden fixed inset-0 bg-black bg-opacity-60 flex justify-center items-center z-50 p-4">
        <div id="mystery-box-content" class="bg-white p-6 sm:p-8 rounded-2xl shadow-xl text-center transform transition-all scale-95 opacity-0">
            <!-- THAY ƒê·ªîI: Ti√™u ƒë·ªÅ h·ªôp qu√† -->
            <h2 class="text-2xl sm:text-3xl font-bold mb-6 text-purple-600">Choose a box to get points!</h2>
            
            <div id="mystery-box-container" class="flex justify-center gap-4 sm:gap-8">
                 <div class="mystery-box-item text-7xl sm:text-8xl cursor-pointer transition-transform hover:scale-110" data-box="1">
                    <!-- THAY ƒê·ªîI: B·ªçc emoji trong span -->
                    <span class="prize-emoji">üéÅ</span>
                </div>
                <div class="mystery-box-item text-7xl sm:text-8xl cursor-pointer transition-transform hover:scale-110" data-box="2">
                    <span class="prize-emoji">üéÅ</span>
                </div>
                <div class="mystery-box-item text-7xl sm:text-8xl cursor-pointer transition-transform hover:scale-110" data-box="3">
                    <span class="prize-emoji">üéÅ</span>
                </div>
            </div>

            <!-- THAY ƒê·ªîI: H∆∞·ªõng d·∫´n -->
            <p class="text-lg mt-4">Click one box to get your points!</p>
        </div>
    </div>


    <script>
        const questions = [
            { num: 10, item: 'üçé', name: 'apple', options: [10, 11, 12] },
            { num: 11, item: '‚≠ê', name: 'star', options: [11, 10, 12] },
            { num: 12, item: 'üöó', name: 'car', options: [12, 13, 11] },
            { num: 13, item: 'üéà', name: 'balloon', options: [13, 12, 14] },
            { num: 14, item: 'üç™', name: 'cookie', options: [14, 15, 13] },
            { num: 15, item: 'üêü', name: 'fish', options: [15, 14, 16] },
            { num: 16, item: 'ü¶ã', name: 'butterfly', options: [16, 17, 15] },
            { num: 17, item: '‚úèÔ∏è', name: 'pencil', options: [17, 16, 18] },
            { num: 18, item: 'üß∏', name: 'teddy bear', options: [18, 19, 17] },
            { num: 19, item: 'üå∏', name: 'flower', options: [19, 18, 20] },
            { num: 20, item: '‚öΩ', name: 'soccer ball', options: [20, 19, 10] }
        ];

        let currentQuestionIndex = 0;
        let draggedElement = null;
        let score = 0;
        let soundStarted = false;
        
        const correctSound = new Tone.PolySynth(Tone.Synth, {
            oscillator: { type: 'sine' }, 
            envelope: { attack: 0.01, decay: 0.1, sustain: 0.1, release: 0.2 }
        }).toDestination();

        const wrongSound = new Tone.PolySynth(Tone.Synth, {
            oscillator: { type: 'sawtooth' }, 
            envelope: { attack: 0.01, decay: 0.2, sustain: 0, release: 0.2 }
        }).toDestination();

        const prizeSound = new Tone.PolySynth(Tone.Synth, { 
            oscillator: { type: 'triangle' }, 
            envelope: { attack: 0.01, decay: 0.1, sustain: 0.2, release: 0.3 }
        }).toDestination();

        const clickSound = new Tone.Synth({
            oscillator: { type: 'triangle' }, 
            envelope: { attack: 0.005, decay: 0.05, sustain: 0, release: 0.1 }
        }).toDestination();
        
        const dropSuccessSound = new Tone.Synth({
            oscillator: { type: 'triangle' }, 
            envelope: { attack: 0.005, decay: 0.05, sustain: 0, release: 0.1 }
        }).toDestination();
        
        const dropFailSound = new Tone.Synth({
            oscillator: { type: 'square' }, 
            envelope: { attack: 0.01, decay: 0.1, sustain: 0, release: 0.1 }
        }).toDestination();
        
        const nextSound = new Tone.Synth({
            oscillator: { type: 'sine' },
            envelope: { attack: 0.005, decay: 0.05, sustain: 0, release: 0.1 }
        }).toDestination();


        function playSound(type) {
            if (!soundStarted) return;
            try {
                if (type === 'correct') {
                    correctSound.triggerAttackRelease('C5', '16n', Tone.now());
                    correctSound.triggerAttackRelease('E5', '16n', Tone.now() + 0.05);
                    correctSound.triggerAttackRelease('G5', '16n', Tone.now() + 0.1);
                    correctSound.triggerAttackRelease('B5', '16n', Tone.now() + 0.15);
                } else if (type === 'wrong') {
                    wrongSound.triggerAttackRelease('G3', '8n', Tone.now());
                    wrongSound.triggerAttackRelease('C3', '8n', Tone.now() + 0.1);
                } else if (type === 'prize') {
                    const now = Tone.now();
                    prizeSound.triggerAttackRelease(['C5', 'G5'], '16n', now);
                    prizeSound.triggerAttackRelease(['E5', 'C6'], '16n', now + 0.15);
                    prizeSound.triggerAttackRelease(['G5', 'E6'], '16n', now + 0.3);
                    // THAY ƒê·ªîI: N·ªët cu·ªëi ho√†nh tr√°ng h∆°n
                    prizeSound.triggerAttackRelease(['C6', 'G6'], '8n', now + 0.45);
                } else if (type === 'click') {
                    clickSound.triggerAttackRelease('C5', '16n', Tone.now()); 
                } else if (type === 'drop-success') {
                    dropSuccessSound.triggerAttackRelease('A5', '16n', Tone.now());
                } else if (type === 'drop-fail') {
                    dropFailSound.triggerAttackRelease('C3', '16n', Tone.now());
                } else if (type === 'next') {
                    nextSound.triggerAttackRelease('E4', '16n', Tone.now());
                }
            } catch (e) {
                console.error("Tone.js error:", e);
            }
        }

        const gameContainer = document.getElementById('game-container');
        const instructionEl = document.getElementById('instruction');
        const itemContainer = document.getElementById('item-container');
        const tensColumn = document.getElementById('tens-column');
        const onesColumn = document.getElementById('ones-column');
        const optionsContainer = document.getElementById('options-container');
        const feedbackEl = document.getElementById('feedback');
        const nextBtn = document.getElementById('next-btn');
        const completionMessage = document.getElementById('completion-message');
        const scoreDisplay = document.getElementById('score-display');
        
        const mysteryBoxOverlay = document.getElementById('mystery-box-overlay');
        const mysteryBoxContent = document.getElementById('mystery-box-content');
        const mysteryBoxContainer = document.getElementById('mystery-box-container'); 
        const startOverlay = document.getElementById('start-overlay');
        const startBtn = document.getElementById('start-btn');
        
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        function updateScoreDisplay() {
            if (scoreDisplay) {
                scoreDisplay.textContent = score;
            }
        }

        function loadQuestion(index) {
            gameContainer.classList.remove('fade-in');
            void gameContainer.offsetWidth;
            gameContainer.classList.add('fade-in');

            updateScoreDisplay();

            const question = questions[index];
            const tens = Math.floor(question.num / 10);
            const ones = question.num % 10;

            itemContainer.innerHTML = '';
            document.getElementById('tens-drop-area').innerHTML = '';
            document.getElementById('ones-drop-area').innerHTML = '';
            optionsContainer.innerHTML = '';
            feedbackEl.textContent = '';
            nextBtn.classList.add('hidden');
            mysteryBoxOverlay.classList.add('hidden');

            const pluralName = question.name.endsWith('h') ? question.name + 'es' : question.name + 's';
            const instructionText = `Okay! Let's count the ${pluralName}! Drag the blocks!`;
            instructionEl.textContent = instructionText;

            for (let i = 0; i < tens; i++) {
                const tensBundle = document.createElement('div');
                tensBundle.id = `tens-${i}`;
                tensBundle.className = 'tens-bundle draggable rounded-lg p-2 draggable';
                tensBundle.draggable = true;
                tensBundle.dataset.type = 'tens';
                let emojis = '';
                for (let j = 0; j < 10; j++) {
                    emojis += `<span class="inline-block w-1/5 h-1/5 flex items-center justify-center">${question.item}</span>`;
                }
                tensBundle.innerHTML = emojis;
                itemContainer.appendChild(tensBundle);
            }

            for (let i = 0; i < ones; i++) {
                const onesItem = document.createElement('div');
                onesItem.id = `ones-${i}`;
                onesItem.className = 'ones-item draggable rounded-lg draggable m-1';
                onesItem.draggable = true;
                onesItem.dataset.type = 'ones';
                onesItem.innerHTML = question.item;
                itemContainer.appendChild(onesItem);
            }
            
            addDragEvents();

            const shuffledOptions = [...question.options];
            shuffleArray(shuffledOptions);
            
            shuffledOptions.forEach(option => {
                const button = document.createElement('button');
                button.className = 'answer-btn text-white font-bold py-2 px-4 text-xl sm:py-3 sm:px-6 sm:text-2xl rounded-lg shadow-md';
                button.textContent = option;
                button.dataset.value = option;
                button.addEventListener('click', (e) => {
                    playSound('click');
                    checkAnswer(e);
                });
                optionsContainer.appendChild(button);
            });
        }
        
        function addDragEvents() {
            const draggables = document.querySelectorAll('.draggable');
            draggables.forEach(draggable => {
                draggable.addEventListener('dragstart', (e) => {
                    draggedElement = e.target.closest('.draggable');
                    if (!draggedElement) return;
                    e.dataTransfer.setData('text/plain', draggedElement.id);
                    setTimeout(() => {
                         draggedElement.style.opacity = '0.5';
                    }, 0);
                });

                draggable.addEventListener('dragend', (e) => {
                    if (draggedElement) {
                        draggedElement.style.opacity = '1';
                    }
                    draggedElement = null;
                });
            });

            const dropColumns = [tensColumn, onesColumn];
            dropColumns.forEach(column => {
                column.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    if (!draggedElement) return;
                    const columnType = column.dataset.column;
                    const draggedType = draggedElement.dataset.type;
                    
                    if (columnType === draggedType) {
                        column.classList.add('drag-over');
                    }
                });

                column.addEventListener('dragleave', () => {
                    column.classList.remove('drag-over');
                });

                column.addEventListener('drop', (e) => {
                    e.preventDefault();
                    column.classList.remove('drag-over');
                    
                    if (draggedElement) {
                        const columnType = e.currentTarget.dataset.column;
                        const draggedType = draggedElement.dataset.type;

                        if (columnType === draggedType) {
                            playSound('drop-success');
                            draggedElement.style.opacity = '1';
                            const dropZone = e.currentTarget.querySelector('.drop-area');
                            dropZone.appendChild(draggedElement); 
                            draggedElement.draggable = false;
                            draggedElement.classList.remove('draggable');
                            draggedElement.style.cursor = 'default';
                        } else {
                            playSound('drop-fail');
                            draggedElement.style.opacity = '1';
                        }
                        draggedElement = null;
                    }
                });
            });
        }

        function checkAnswer(e) {
            const selectedAnswer = parseInt(e.target.dataset.value);
            const correctAnswer = questions[currentQuestionIndex].num;

            optionsContainer.querySelectorAll('button').forEach(btn => {
                btn.disabled = true;
                if (parseInt(btn.dataset.value) === correctAnswer) {
                    btn.classList.add('btn-correct');
                } else if (parseInt(btn.dataset.value) === selectedAnswer) {
                    btn.classList.add('btn-wrong');
                }
            });

            if (selectedAnswer === correctAnswer) {
                // THAY ƒê·ªîI: X√≥a score++
                // score++; 
                // updateScoreDisplay();
                const feedbackText = 'Awesome! That\'s right!';
                feedbackEl.textContent = feedbackText;
                feedbackEl.className = 'text-green-600 text-xl font-semibold mb-4';
                playSound('correct');
                
                // THAY ƒê·ªîI: Hi·ªÉn th·ªã h·ªôp qu√† sau 1 gi√¢y
                setTimeout(showMysteryBox, 1000);

            } else {
                const feedbackText = `Oops! Not quite. The answer was ${correctAnswer}.`;
                feedbackEl.textContent = feedbackText;
                feedbackEl.className = 'text-red-600 text-xl font-semibold mb-4';
                playSound('wrong');
                
                // THAY ƒê·ªîI: Hi·ªÉn th·ªã h·ªôp qu√† (thay v√¨ t·ª± ƒë·ªông next)
                setTimeout(showMysteryBox, 1000); 
            }
        }

        function showMysteryBox() {
            // THAY ƒê·ªîI: ƒê·ªãnh nghƒ©a v√† x√°o tr·ªôn ƒëi·ªÉm
            const points = [1, 5, 10];
            shuffleArray(points);

            mysteryBoxContainer.querySelectorAll('.mystery-box-item').forEach((box, index) => {
                // THAY ƒê·ªîI: ƒê·∫∑t l·∫°i HTML thay v√¨ textContent
                box.innerHTML = '<span class="prize-emoji">üéÅ</span>';
                box.style.animation = 'pulseSimple 1.5s infinite ease-in-out'; 
                box.style.opacity = '1';
                box.style.pointerEvents = 'auto'; 
                box.dataset.points = points[index];

                // X√≥a ƒëi·ªÉm c≈© (n·∫øu c√≥)
                const oldPoints = box.querySelector('.points-display');
                if (oldPoints) {
                    oldPoints.remove();
                }
            });
            
            mysteryBoxOverlay.classList.remove('hidden');
            setTimeout(() => {
                mysteryBoxContent.classList.remove('scale-95', 'opacity-0');
                mysteryBoxContent.classList.add('scale-100', 'opacity-100');
            }, 10);
        }

        mysteryBoxContainer.querySelectorAll('.mystery-box-item').forEach(box => {
            box.addEventListener('click', (e) => {
                const clickedBox = e.currentTarget;

                // THAY ƒê·ªîI: L·∫•y ƒëi·ªÉm t·ª´ h·ªôp qu√†
                const pointsWon = parseInt(clickedBox.dataset.points);
                
                score += pointsWon;
                updateScoreDisplay(); 

                // THAY ƒê·ªîI: Hi·ªÉn th·ªã ƒëi·ªÉm ki·ªÉu m·ªõi
                const pointsEl = document.createElement('div');
                pointsEl.className = 'points-display';
                pointsEl.textContent = `+${pointsWon}`;
                clickedBox.appendChild(pointsEl);
                // L√†m m·ªù emoji
                clickedBox.querySelector('.prize-emoji').style.opacity = '0.2';
                
                clickedBox.style.animation = 'none';
                
                playSound('prize');
                
                mysteryBoxContainer.querySelectorAll('.mystery-box-item').forEach(otherBox => {
                    otherBox.style.pointerEvents = 'none'; 
                    if (otherBox !== clickedBox) {
                        otherBox.style.opacity = '0.5';
                        otherBox.style.animation = 'none';
                        
                        // THAY ƒê·ªîI: Hi·ªÉn th·ªã ƒëi·ªÉm c·ªßa c√°c h·ªôp kh√°c (ki·ªÉu m·ªù)
                        const otherPointsEl = document.createElement('div');
                        otherPointsEl.className = 'points-display';
                        otherPointsEl.textContent = `+${otherBox.dataset.points}`;
                        otherPointsEl.style.animation = 'none'; // Kh√¥ng animation
                        otherPointsEl.style.opacity = '0.7'; // M·ªù h∆°n
                        otherPointsEl.style.transform = 'translate(-50%, -50%) scale(0.7)'; // Nh·ªè h∆°n
                        otherPointsEl.style.color = '#9CA3AF'; // M√†u x√°m
                        otherPointsEl.style.textShadow = 'none'; // Kh√¥ng b√≥ng
                        otherBox.appendChild(otherPointsEl);
                        otherBox.querySelector('.prize-emoji').style.opacity = '0.2';
                    }
                });

                setTimeout(() => {
                    mysteryBoxOverlay.classList.add('hidden');
                    mysteryBoxContent.classList.add('scale-95', 'opacity-0');
                    mysteryBoxContent.classList.remove('scale-100', 'opacity-100');
                    nextQuestionLogic(); 
                }, 2000); // TƒÉng th·ªùi gian ch·ªù ƒë·ªÉ b√© th·∫•y ƒëi·ªÉm
            });
        });

        function nextQuestionLogic() {
            currentQuestionIndex++;
            if (currentQuestionIndex < questions.length) {
                loadQuestion(currentQuestionIndex);
            } else {
                gameContainer.innerHTML = '';
                // THAY ƒê·ªîI: Th√¥ng ƒëi·ªáp k·∫øt th√∫c v·ªõi t·ªïng ƒëi·ªÉm
                const finalScoreText = `Your final score is ${score} points!`;
                completionMessage.innerHTML = `üéâ Yippee! You finished the game! üéâ<br><span class="text-2xl mt-4">${finalScoreText}</span>`;
                gameContainer.appendChild(completionMessage);
                completionMessage.classList.remove('hidden');
            }
        }

        startBtn.addEventListener('click', () => {
            Tone.start();
            soundStarted = true;
            
            startOverlay.style.display = 'none';
            gameContainer.classList.remove('hidden');
            
            shuffleArray(questions);
            loadQuestion(currentQuestionIndex);
        });

    </script>
</body>
</html>
